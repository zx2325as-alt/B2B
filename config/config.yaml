# =============================================================================
# BtB 系统主配置文件 (Main Configuration)
# =============================================================================
# 本文件管理系统的基础设施连接（数据库、LLM、网络端口）。
# 提示词和模型行为参数请移步至 `prompts.yaml`。
# 修改后通常需要重启服务生效。
#
# ==========================================
# 1. 应用基础配置 (App Settings)
# ==========================================
app:
  name: "BtB System"
  version: "1.0.0"
  description: "Deep Dialogue Understanding and Personalized Translation System"
  debug: true  # 开启调试模式 (Reload, Debug Logs)
  
  # [默认场景]
  # 如果场景检测模块无法确定用户意图，或者用户初次进入时，默认加载的场景。
  # 必须与 prompts.yaml 中 scenarios 列表下的某个 name 匹配。
  default_scenario: "深度对话理解与个性化翻译中枢" 

# ==========================================
# 2. 服务器与端口配置 (Server & Ports)
# ==========================================
server:
  host: "127.0.0.1"       # 监听地址 (0.0.0.0 允许局域网访问，127.0.0.1 仅限本机)
  backend_port: 8000      # FastAPI 后端 API 服务端口
  admin_port: 8501        # Streamlit 管理后台端口 (用于数据管理)
  chat_port: 8502         # Streamlit 聊天前端端口 (用户交互界面)

# ==========================================
# 3. 大语言模型配置 (LLM Settings)
# ==========================================
# 决定了系统“大脑”的连接方式。
llm:
  # API Key: 模型的访问密钥。
  # 优先读取此处配置。为了安全，生产环境建议留空并使用环境变量 LLM_API_KEY。
  api_key: "sk-803936ec8add440db0dca13ec660f070" 
  
  # Base URL: 模型 API 地址。
  # - OpenAI: https://api.openai.com/v1
  # - DeepSeek: https://api.deepseek.com/v1
  # - Local (vLLM/Ollama): http://localhost:8000/v1
  base_url: "https://api.deepseek.com/v1"

  # Model Name: 使用的模型名称。必须与服务商支持的模型ID一致。
  model: "deepseek-chat"
  
  # Timeout: 请求超时时间 (秒)。对于长思考模型，建议设置较长 (如 120s)。
  timeout: 300.0
  
  # Proxy: HTTP 代理地址 (例如 http://127.0.0.1:7890)。
  # 在国内访问 OpenAI 等海外服务时通常需要配置。访问国内模型 (DeepSeek) 可留空。
  proxy: ""

# ==========================================
# 4. 知识库与 RAG 配置 (RAG Settings)
# ==========================================
# 决定了系统如何检索“长期记忆”。
rag:
  similarity_top_k: 3     # 每次检索返回的最相关文档数量。数量过多会消耗 token，过少可能遗漏信息。
  chunk_size: 512         # 文档切片大小 (Tokens)。决定了记忆碎片的粒度。

# ==========================================
# 5. 数据库配置 (Database Settings)
# ==========================================
database:
  # 数据库连接字符串 (SQLAlchemy 格式)。
  #
  # [关于 btb.db 与 btb_v2.db 的区别]
  # - btb.db: 旧版本数据库文件（可能已废弃）。
  # - btb_v2.db: 当前系统正在使用的活跃数据库。
  #
  # 默认使用 SQLite。路径中的 ./data/ 指向项目根目录下的 data 文件夹。
  url: "sqlite:///./data/btb_v2.db" 

# ==========================================
# 6. 中间件与缓存配置 (Middleware)
# ==========================================
# [已精简] Redis 与 Celery 配置已移除，
# 因为当前版本采用了更轻量级的内存队列或同步处理，
# 减少了对外部服务的依赖，降低了部署复杂度。

# ==========================================
# 7. 用户默认配置 (User Defaults)
# ==========================================
user:
  default_profile_id: "guest" # 匿名用户登录时的默认身份 ID

character_formatter:
  template: |
    姓名：{name}
    年龄：{age} | 职业：{occupation} | 身份：{role}
    性格：{personality}
    背景：{background}
    弱点：{weakness}
  
  defaults:
    unknown: "未知"

  # Core Structured Fields for Profile Template
  core_template_fields: ["沟通模式", "决策风格", "核心诉求", "情绪基线", "可信度"]

